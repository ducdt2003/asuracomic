<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lịch sử giao dịch - AsuraComic</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
    <link rel="stylesheet" href="/css/admin-assets/plugins/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="/css/admin-assets/dist/css/adminlte.min.css" />
</head>
<body class="hold-transition layout-top-nav">
<div class="wrapper">
    <nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
        <div class="container">
            <a href="/asura" class="navbar-brand">
                <img src="/css/admin-assets/dist/img/AdminLTELogo.png" alt="Logo" class="brand-image img-circle elevation-3" style="opacity: 0.8" />
                <span class="brand-text font-weight-light">AsuraComic</span>
            </a>
            <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse order-3" id="navbarCollapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="/asura" class="nav-link">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a href="/asura/purchase" class="nav-link">Nạp coin</a>
                    </li>
                    <li class="nav-item">
                        <a href="/asura/membership" class="nav-link">Mua VIP</a>
                    </li>
                    <li class="nav-item">
                        <a href="/asura/transaction-history" class="nav-link active">Lịch sử giao dịch</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item dropdown" th:if="${session.currentUser != null}">
                        <a class="nav-link" data-toggle="dropdown" href="#">
                            <i class="fas fa-user"></i> <span th:text="${session.currentUser.username ?: 'N/A'}"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a href="/asura/logout" class="dropdown-item">Đăng xuất</a>
                        </div>
                    </li>
                    <li class="nav-item" th:if="${session.currentUser == null}">
                        <a href="/asura/login" class="nav-link">Đăng nhập</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="content-wrapper">
        <div class="content-header">
            <div class="container">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">Lịch sử giao dịch</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/asura">Trang chủ</a></li>
                            <li class="breadcrumb-item active">Lịch sử giao dịch</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <section class="content">
            <div class="container">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Danh sách giao dịch</h3>
                    </div>
                    <div class="card-body">
                        <div th:if="${transactionsPage.content == null or transactionsPage.content.empty}">
                            <p class="text-center">Bạn chưa có giao dịch nào.</p>
                        </div>
                        <div th:unless="${transactionsPage.content == null or transactionsPage.content.empty}">
                            <table class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>Thời gian</th>
                                    <th>Loại giao dịch</th>
                                    <th>Số coin</th>
                                    <th>Chi tiết</th>
                                    <th>Ngày mua VIP</th>
                                    <th>Ngày hết hạn VIP</th>
                                    <th>Trạng thái</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="txn : ${transactionsPage.content}">
                                    <td th:text="${txn.createdAt != null ? #temporals.format(txn.createdAt, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>
                                    <td th:switch="${txn.transactionType}">
                                        <span th:case="'CHAPTER_UNLOCK'" th:text="'Mở khóa chương'"></span>
                                        <span th:case="'VIP_PURCHASE'" th:text="'Mua VIP'"></span>
                                        <span th:case="*" th:text="'Không xác định: ' + ${txn.transactionType ?: 'null'}"></span>
                                    </td>
                                    <td th:text="${txn.amount != null ? (txn.amount + ' coin') : 'N/A'}"></td>
                                    <td th:switch="${txn.transactionType}">
                                        <span th:case="'CHAPTER_UNLOCK'" th:text="'Chương: ' + ${txn.chapter?.title ?: 'N/A'}"></span>
                                        <span th:case="'VIP_PURCHASE'" th:text="'Gói VIP: ' + ${txn.vipConfig?.name ?: 'N/A'}"></span>
                                        <span th:case="*" th:text="'N/A'"></span>
                                    </td>
                                    <td th:text="${txn.transactionType == 'VIP_PURCHASE' and txn.vipStartDate != null ? #temporals.format(txn.vipStartDate, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>

                                    <td th:text="${user.vipExpiryDate != null ? #temporals.format(user.vipExpiryDate, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>

                                    <td th:text="${txn.status ?: 'N/A'}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer" th:unless="${transactionsPage.content == null or transactionsPage.content.empty}">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item" th:classappend="${transactionsPage.first} ? 'disabled'">
                                    <a class="page-link" th:href="@{/asura/transaction-history(page=${currentPage - 1})}">« Trước</a>
                                </li>
                                <li th:each="i : ${#numbers.sequence(0, transactionsPage.totalPages - 1)}"
                                    class="page-item"
                                    th:classappend="${i == currentPage} ? 'active'">
                                    <a class="page-link" th:text="${i + 1}"
                                       th:href="@{/asura/transaction-history(page=${i})}"></a>
                                </li>
                                <li class="page-item" th:classappend="${transactionsPage.last} ? 'disabled'">
                                    <a class="page-link" th:href="@{/asura/transaction-history(page=${currentPage + 1})}">Tiếp »</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Version</b> 1.0.0
        </div>
        <strong>Copyright &copy; 2025 AsuraComic.</strong> All rights reserved.
    </footer>
</div>

<script src="/css/admin-assets/plugins/jquery/jquery.min.js"></script>
<script src="/css/admin-assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/css/admin-assets/dist/js/adminlte.min.js"></script>
</body>
</html>
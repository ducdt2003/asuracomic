<!--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AdminLTE 3 | Chỉnh sửa phim</title>

    &lt;!&ndash; Google Font &ndash;&gt;
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
    &lt;!&ndash; Font Awesome &ndash;&gt;
    <link rel="stylesheet" href="/css/admin-assets/plugins/fontawesome-free/css/all.min.css" />
    &lt;!&ndash; AdminLTE &ndash;&gt;
    <link rel="stylesheet" href="/css/admin-assets/dist/css/adminlte.min.css" />
    &lt;!&ndash; Select2 &ndash;&gt;
    <link rel="stylesheet" href="/css/admin-assets/plugins/select2/css/select2.min.css" />
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    &lt;!&ndash; Navbar &ndash;&gt;
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        &lt;!&ndash; Left navbar links &ndash;&gt;
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
        </ul>

        &lt;!&ndash; Right navbar links &ndash;&gt;
        <ul class="navbar-nav ml-auto">
            &lt;!&ndash; User Dropdown &ndash;&gt;
            <li class="nav-item dropdown">
                <a class="nav-link py-0 d-flex align-items-center" data-toggle="dropdown" href="#">
                    <div class="user-panel">
                        <div class="image">
                            <img src="../../dist/img/user2-160x160.jpg" class="img-circle border" alt="User Image">
                        </div>
                    </div>
                </a>
                <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                    <a href="#" class="dropdown-item">
                        <span class="text-muted">Trang chủ</span>
                    </a>
                    <a href="#" class="dropdown-item">
                        <span class="text-muted">Đăng xuất</span>
                    </a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                    <i class="fas fa-expand-arrows-alt"></i>
                </a>
            </li>
        </ul>
    </nav>

    &lt;!&ndash; Sidebar &ndash;&gt;
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        &lt;!&ndash; Brand Logo &ndash;&gt;
        <a href="./index.html" class="brand-link">
            <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                 style="opacity: 0.8" />
            <span class="brand-text font-weight-light">Admin</span>
        </a>

        &lt;!&ndash; Sidebar Menu &ndash;&gt;
        <div class="sidebar">
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-chart-pie"></i>
                            <p>
                                Quản lý bài viết
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="./blog-index.html" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Tất cả bài viết</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="./blog-yourself.html" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Bài viết của tôi</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="./blog-create.html" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Tạo bài viết</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-tree"></i>
                            <p>
                                Quản lý user
                                <i class="fas fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="pages/UI/general.html" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Danh sách user</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="pages/UI/icons.html" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Tạo user</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>

    &lt;!&ndash; Content Wrapper &ndash;&gt;
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="/admin/movies">Phim</a></li>
                            <li class="breadcrumb-item active">Chỉnh sửa phim</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        &lt;!&ndash; Main content &ndash;&gt;
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Chỉnh sửa phim</h3>
                            </div>
                            <div class="card-body">
                                <form action="/admin/movies/edit/1" method="post">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>Tên phim</label>
                                                <input type="text" class="form-control" name="name" value="Avengers: Endgame" required />
                                            </div>
                                            <div class="form-group">
                                                <label>Mô tả</label>
                                                <textarea class="form-control" rows="5" name="description">Trận chiến cuối cùng chống lại Thanos.</textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Trailer (URL)</label>
                                                <input type="text" class="form-control" name="trailerUrl" value="https://youtube.com/trailer" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Trạng thái</label>
                                                <select class="form-control" name="status">
                                                    <option value="true" selected>Công khai</option>
                                                    <option value="false">Nháp</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Loại phim</label>
                                                <select class="form-control" name="type">
                                                    <option selected>Phim lẻ</option>
                                                    <option>Phim bộ</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Năm phát hành</label>
                                                <input type="number" class="form-control" name="releaseYear" value="2019" />
                                            </div>
                                            <div class="form-group">
                                                <label>Quốc gia</label>
                                                <select class="form-control" name="countryId">
                                                    <option value="">Chọn quốc gia</option>
                                                    <option value="1" selected>Mỹ</option>
                                                    <option value="2">Nhật Bản</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Thể loại</label>
                                                <select class="select2 form-control" multiple name="genreIds">
                                                    <option value="1" selected>Hành động</option>
                                                    <option value="2" selected>Khoa học viễn tưởng</option>
                                                    <option value="3">Hài</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Diễn viên</label>
                                                <select class="select2 form-control" multiple name="actorIds">
                                                    <option value="1" selected>Robert Downey Jr.</option>
                                                    <option value="2" selected>Chris Evans</option>
                                                    <option value="3">Scarlett Johansson</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Đạo diễn</label>
                                                <select class="select2 form-control" multiple name="directorIds">
                                                    <option value="1" selected>Anthony Russo</option>
                                                    <option value="2" selected>Joe Russo</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                                        <a href="/admin/movies" class="btn btn-default">Hủy</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

&lt;!&ndash; Scripts &ndash;&gt;
<script src="/css/admin-assets/plugins/jquery/jquery.min.js"></script>
<script src="/css/admin-assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/css/admin-assets/plugins/select2/js/select2.full.min.js"></script>
<script src="/css/admin-assets/dist/js/adminlte.min.js"></script>
<script>
    $(document).ready(function () {
        $('.select2').select2();
    });
</script>
</body>
</html>
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AdminLTE 3 | Chỉnh sửa truyện</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/admin-assets/plugins/fontawesome-free/css/all.min.css" />
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
    <!-- Theme style -->
    <link rel="stylesheet" href="/css/admin-assets/dist/css/adminlte.min.css" />
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/css/admin-assets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css" />
    <!-- EasyMDE for description editing -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css" />
    <!-- Select2 for multi-select -->
    <link rel="stylesheet" href="/css/admin-assets/plugins/select2/css/select2.min.css" />
    <link rel="stylesheet" href="/css/admin-assets/dist/css/style.css">
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link py-0 d-flex align-items-center" data-toggle="dropdown" href="#">
                    <div class="user-panel">
                        <div class="image">
                            <img src="/css/admin-assets/dist/img/user2-160x160.jpg" class="img-circle border" alt="User Image">
                        </div>
                    </div>
                </a>
                <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                    <a href="#" class="dropdown-item"><span class="text-muted">Trang chủ</span></a>
                    <a href="#" class="dropdown-item"><span class="text-muted">Đăng xuất</span></a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                    <i class="fas fa-expand-arrows-alt"></i>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Sidebar -->
<!--    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <a href="./index.html" class="brand-link">
            <img src="/css/admin-assets/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: 0.8" />
            <span class="brand-text font-weight-light">Admin</span>
        </a>
        <div class="sidebar">
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                    &lt;!&ndash; Tổng quan &ndash;&gt;
                    <li class="nav-item">
                        <a href="/asura/admin/comic" class="nav-link active">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>Tổng quan</p>
                        </a>
                    </li>
                    &lt;!&ndash; Quản lý Truyện &ndash;&gt;
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-book"></i>
                            <p>
                                Quản lý Truyện
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="/asura/admin/comic/detail" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Tất cả Truyện</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/asura/admin/comic/create" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Thêm/Update Truyện</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    &lt;!&ndash; Quản lý User &ndash;&gt;
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-users"></i>
                            <p>
                                Quản lý Người dùng
                                <i class="fas fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="/asura/admin/comic/users" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Danh sách Người dùng</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/asura/admin/comic/users/create" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Tạo Người dùng</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    &lt;!&ndash; Quản lý Tương tác &ndash;&gt;
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-comments"></i>
                            <p>
                                Quản lý Tương tác
                                <i class="fas fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="/asura/admin/interactions/comments" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Bình luận</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/asura/admin/interactions/likes" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Doanh thu</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/asura/admin/interactions/reports" class="nav-link">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Báo cáo vi phạm</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>

            </nav>
        </div>
    </aside>-->
    <th:block th:replace="~{admin-templ/fragments/sidebar :: sidebar}"></th:block>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="/admin/comics">Truyện</a></li>
                            <li class="breadcrumb-item active" id="comic-title-breadcrumb">Chỉnh sửa truyện</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Chỉnh sửa truyện</h3>
                            </div>
                            <div class="card-body">
                                <form id="comic-form">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>Tiêu đề <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="title" name="title" required />
                                            </div>
                                            <div class="form-group">
                                                <label>Slug <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="slug" name="slug" required />
                                            </div>
                                            <div class="form-group">
                                                <label>Mô tả</label>
                                                <textarea id="description" name="description"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Serialization</label>
                                                <input type="text" class="form-control" id="serialization" name="serialization" />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Trạng thái</label>
                                                <select id="status" name="status" class="form-control">
                                                    <option value="ONGOING">Đang tiến hành</option>
                                                    <option value="COMPLETED">Hoàn thành</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Loại truyện</label>
                                                <select id="type" name="type" class="form-control">
                                                    <option value="MANHWA">Manhwa</option>
                                                    <option value="MANGA">Manga</option>
                                                    <option value="MANHUA">Manhua</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Thể loại</label>
                                                <select class="select2 form-control" multiple id="genres" name="genreIds">
                                                    <!-- Populated dynamically -->
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Tác giả</label>
                                                <select class="select2 form-control" multiple id="authors" name="authorIds">
                                                    <!-- Populated dynamically -->
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Họa sĩ</label>
                                                <select class="select2 form-control" multiple id="artists" name="artistIds">
                                                    <!-- Populated dynamically -->
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Hình bìa</label>
                                                <div class="thumbnail-preview-container mb-3">
                                                    <img src="" alt="Hình bìa" id="coverImage" style="max-width: 100%; height: auto;" />
                                                </div>
                                                <button type="button" class="btn btn-info btn-flat" data-toggle="modal" data-target="#modal-xl">
                                                    Chọn hình ảnh
                                                </button>
                                            </div>
                                            <div class="form-group">
                                                <label>Trạng thái xuất bản</label>
                                                <select id="isPublished" name="isPublished" class="form-control">
                                                    <option value="true">Công khai</option>
                                                    <option value="false">Ẩn</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Chapters Section -->
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Danh sách chương</h3>
                                                    <div class="card-tools">
                                                        <a th:href="@{/asura/admin/comic/chapter/update/{comicId}(comicId=${comic.id})}" class="btn btn-sm btn-primary">Thêm chương</a>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                        <tr>
                                                            <th>Số chương</th>
                                                            <th>Tiêu đề</th>
                                                            <th>Lượt xem</th>
                                                            <th>Miễn phí</th>
                                                            <th>Giá coin</th>
                                                            <th>Trạng thái</th>
                                                            <th>Hành động</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr th:each="chapter : ${chapterPage.content}">
                                                            <td th:text="${chapter.chapterNumber}"></td>
                                                            <td th:text="${chapter.title}"></td>
                                                            <td th:text="${chapter.viewCount}"></td>
                                                            <td th:text="${chapter.isFree} ? 'Có' : 'Không'"></td>
                                                            <td th:text="${chapter.coinPrice}"></td>
                                                            <td th:text="${chapter.isPublished} ? 'Công khai' : 'Ẩn'"></td>
                                                            <td>
                                                                <a th:href="@{/asura/admin/comic/chapter/update/{chapterId}(chapterId=${chapter.id})}"
                                                                   class="btn btn-sm btn-warning">Sửa</a>
                                                                <button class="btn btn-sm btn-danger" th:onclick="'deleteChapter(' + ${chapter.id} + ')'">Xóa</button>
                                                            </td>
                                                        </tr>
                                                        <tr th:if="${#lists.isEmpty(chapterPage.content)}">
                                                            <td colspan="7" class="text-center">Chưa có chương nào</td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                    <div th:if="${chapterPage.totalPages > 1}">
                                                        <ul class="pagination"
                                                            style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">

                                                            <li class="page-item" th:classappend="${chapterPage.isFirst()} ? 'disabled'">
                                                                <a class="page-link"
                                                                   style="color: #28a745; border: 1px solid #dee2e6; padding: 6px 12px; text-decoration: none; border-radius: 5px; background-color: #f8f9fa; transition: color 0.3s, background-color 0.3s;"
                                                                   th:href="@{/asura/admin/comic/{slug}(slug=${comic.slug}, page=${chapterPage.number - 1}, size=${chapterPage.size})}"
                                                                   th:style="${chapterPage.isFirst()} ? 'color: #6c757d; background-color: #e9ecef; cursor: not-allowed;' : 'color: #28a745;'"
                                                                   onmouseover="this.style.backgroundColor='#e9ecef'; this.style.color='#218838';"
                                                                   onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.color='#28a745';">«</a>
                                                            </li>

                                                            <li class="page-item"
                                                                th:each="i : ${#numbers.sequence(0, chapterPage.totalPages - 1)}"
                                                                th:classappend="${i == chapterPage.number} ? 'active'"
                                                                style="margin: 0 5px;">
                                                                <a class="page-link"
                                                                   style="color: #0d6efd; border: 1px solid #dee2e6; padding: 6px 12px; text-decoration: none; border-radius: 5px; background-color: #f8f9fa; transition: color 0.3s, background-color 0.3s;"
                                                                   th:href="@{/asura/admin/comic/{slug}(slug=${comic.slug}, page=${i}, size=${chapterPage.size})}"
                                                                   th:text="${i + 1}"
                                                                   th:style="${i == chapterPage.number} ? 'color: #fff; background-color: #0d6efd; border-color: #0d6efd;' : ''"
                                                                   onmouseover="if (!this.parentElement.classList.contains('active')) { this.style.backgroundColor='#e9ecef'; this.style.color='#0b5ed7'; }"
                                                                   onmouseout="if (!this.parentElement.classList.contains('active')) { this.style.backgroundColor='#f8f9fa'; this.style.color='#0d6efd'; }"></a>
                                                            </li>

                                                            <li class="page-item" th:classappend="${chapterPage.isLast()} ? 'disabled'">
                                                                <a class="page-link"
                                                                   style="color: #28a745; border: 1px solid #dee2e6; padding: 6px 12px; text-decoration: none; border-radius: 5px; background-color: #f8f9fa; transition: color 0.3s, background-color 0.3s;"
                                                                   th:href="@{/asura/admin/comic/{slug}(slug=${comic.slug}, page=${chapterPage.number + 1}, size=${chapterPage.size})}"
                                                                   th:style="${chapterPage.isLast()} ? 'color: #6c757d; background-color: #e9ecef; cursor: not-allowed;' : 'color: #28a745;'"
                                                                   onmouseover="this.style.backgroundColor='#e9ecef'; this.style.color='#218838';"
                                                                   onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.color='#28a745';">»</a>
                                                            </li>
                                                        </ul>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                                        <a th:href="@{/asura/admin/comic/{slug}(slug=${comic.slug})}" class="btn btn-default">Hủy</a>
                                        <button type="button" class="btn btn-danger" onclick="deleteComic()">Xóa truyện</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Image Selection Modal -->
        <div class="modal fade" id="modal-xl" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Chọn hình bìa</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <input type="file" id="imageUpload" accept="image/*" />
                        <div id="imagePreview" class="mt-3"></div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-primary" onclick="saveImage()">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/css/admin-assets/plugins/jquery/jquery.min.js"></script>
    <script src="/css/admin-assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/css/admin-assets/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <script src="/css/admin-assets/dist/js/adminlte.js"></script>
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>
    <script src="/css/admin-assets/plugins/select2/js/select2.full.min.js"></script>
    <script>
        $(document).ready(function () {
            // Initialize Select2
            $('.select2').select2();

            // Initialize EasyMDE for description
            const easyMDE = new EasyMDE({
                element: document.getElementById('description'),
                spellChecker: false,
                maxHeight: '300px',
                renderingConfig: { codeSyntaxHighlighting: true }
            });

            // Mock comic data (replace with API call in production)
            const comicData = {
                id: 1,
                title: "One Piece",
                slug: "one-piece",
                description: "The story follows the adventures of Monkey D. Luffy and his pirate crew...",
                coverImage: "https://example.com/one-piece-cover.jpg",
                viewCount: 1000000,
                followCount: 500000,
                averageRating: 4.8,
                status: "ONGOING",
                type: "MANGA",
                isPublished: true,
                serialization: "Weekly Shonen Jump",
                createdAt: "2020-01-01T00:00:00",
                updatedAt: "2025-08-14T14:57:00",
                genres: [{ id: 1, name: "Action" }, { id: 2, name: "Adventure" }],
                authors: [{ id: 1, name: "Eiichiro Oda" }],
                artists: [{ id: 1, name: "Eiichiro Oda" }],
                chapters: [
                    { id: 1, chapterNumber: 1, title: "Romance Dawn", slug: "chapter-1", isFree: true, coinPrice: 0, viewCount: 50000, isPublished: true },
                    { id: 2, chapterNumber: 2, title: "The Man in the Straw Hat", slug: "chapter-2", isFree: false, coinPrice: 5.00, viewCount: 45000, isPublished: true }
                ]
            };

            // Initialize form data
            function initData(data) {
                $('#title').val(data.title);
                $('#slug').val(data.slug);
                easyMDE.value(data.description || '');
                $('#serialization').val(data.serialization || '');
                $('#status').val(data.status);
                $('#type').val(data.type);
                $('#isPublished').val(data.isPublished.toString());
                $('#coverImage').attr('src', data.coverImage || '');
                $('#comic-title-breadcrumb').text(data.title);

                // Populate genres (mock API call)
                $.ajax({
                    url: '/api/genres',
                    success: function(genres) {
                        $('#genres').empty();
                        genres.forEach(genre => {
                            const selected = data.genres.some(g => g.id === genre.id) ? 'selected' : '';
                            $('#genres').append(`<option value="${genre.id}" ${selected}>${genre.name}</option>`);
                        });
                        $('#genres').trigger('change');
                    }
                });

                // Populate authors (mock API call)
                $.ajax({
                    url: '/api/authors',
                    success: function(authors) {
                        $('#authors').empty();
                        authors.forEach(author => {
                            const selected = data.authors.some(a => a.id === author.id) ? 'selected' : '';
                            $('#authors').append(`<option value="${author.id}" ${selected}>${author.name}</option>`);
                        });
                        $('#authors').trigger('change');
                    }
                });

                // Populate artists (mock API call)
                $.ajax({
                    url: '/api/artists',
                    success: function(artists) {
                        $('#artists').empty();
                        artists.forEach(artist => {
                            const selected = data.artists.some(a => a.id === artist.id) ? 'selected' : '';
                            $('#artists').append(`<option value="${artist.id}" ${selected}>${artist.name}</option>`);
                        });
                        $('#artists').trigger('change');
                    }
                });

                // Populate chapters
                $('#chapters-table').empty();
                data.chapters.forEach(chapter => {
                    $('#chapters-table').append(`
                        <tr>
                            <td>${chapter.chapterNumber}</td>
                            <td>${chapter.title}</td>
                            <td>${chapter.viewCount}</td>
                            <td>${chapter.isFree ? 'Miễn phí' : 'Trả phí'}</td>
                            <td>${chapter.coinPrice}</td>
                            <td>${chapter.isPublished ? 'Công khai' : 'Ẩn'}</td>
                            <td>
                                <a href="./chapters-edit.html?chapterId=${chapter.id}" class="btn btn-sm btn-primary">Sửa</a>
                                <button class="btn btn-sm btn-danger" onclick="deleteChapter(${chapter.id})">Xóa</button>
                            </td>
                        </tr>
                    `);
                });
            }

            // Form submission
            $('#comic-form').on('submit', function(e) {
                e.preventDefault();
                const comic = {
                    id: comicData.id,
                    title: $('#title').val(),
                    slug: $('#slug').val(),
                    description: easyMDE.value(),
                    serialization: $('#serialization').val(),
                    status: $('#status').val(),
                    type: $('#type').val(),
                    isPublished: $('#isPublished').val() === 'true',
                    genres: $('#genres').val().map(id => ({ id: parseInt(id) })),
                    authors: $('#authors').val().map(id => ({ id: parseInt(id) })),
                    artists: $('#artists').val().map(id => ({ id: parseInt(id) })),
                    coverImage: $('#coverImage').attr('src')
                };
                $.ajax({
                    url: `/api/comics/${comic.id}`,
                    method: 'PUT',
                    data: JSON.stringify(comic),
                    contentType: 'application/json',
                    success: function(response) {
                        alert('Lưu thành công!');
                        window.location.href = '/admin/comics';
                    },
                    error: function() {
                        alert('Lưu thất bại!');
                    }
                });
            });

            // Delete comic
            function deleteComic() {
                if (confirm('Bạn có chắc muốn xóa truyện này?')) {
                    $.ajax({
                        url: `/api/comics/${comicData.id}`,
                        method: 'DELETE',
                        success: function() {
                            alert('Xóa thành công!');
                            window.location.href = '/admin/comics';
                        },
                        error: function() {
                            alert('Xóa thất bại!');
                        }
                    });
                }
            }

            // Delete chapter
            function deleteChapter(chapterId) {
                if (confirm('Bạn có chắc muốn xóa chương này?')) {
                    $.ajax({
                        url: `/api/chapters/${chapterId}`,
                        method: 'DELETE',
                        success: function() {
                            alert('Xóa chương thành công!');
                            location.reload();
                        },
                        error: function() {
                            alert('Xóa chương thất bại!');
                        }
                    });
                }
            }

            // Handle image upload
            $('#imageUpload').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#imagePreview').html(`<img src="${e.target.result}" style="max-width: 100%; height: auto;" />`);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Save image
            function saveImage() {
                const src = $('#imagePreview img').attr('src');
                if (src) {
                    $('#coverImage').attr('src', src);
                    $('#modal-xl').modal('hide');
                } else {
                    alert('Vui lòng chọn hình ảnh!');
                }
            }

            // Add chapter button (mock navigation)
            $('#add-chapter-btn').on('click', function() {
                window.location.href = `./chapters-create.html?comicId=${comicData.id}`;
            });

            // Initialize with comic data
            initData(comicData);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Quản Lý Nội Dung | AdminLTE 3</title>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
	<link rel="stylesheet" href="/css/admin-assets/plugins/fontawesome-free/css/all.min.css" />
	<link rel="stylesheet" href="/css/admin-assets/dist/css/adminlte.min.css" />
	<link rel="stylesheet" href="/css/admin-assets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css" />

	<style>
		/* Tối ưu bảng hiển thị nội dung */
        #comicsTable { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; background-color: #fff; border-radius: 8px; overflow: hidden; }
        #comicsTable thead { background-color: #f8f9fa; color: #333; }
        #comicsTable th, #comicsTable td { padding: 12px 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        #comicsTable tbody tr:hover { background-color: #f1f7ff; transition: 0.2s; }

        .action-buttons a { margin: 0 5px; font-size: 16px; color: #6c757d; }
        .action-buttons a:hover { color: #007bff; }
        .action-buttons .delete:hover { color: #dc3545; }

        /* Pagination tinh gọn */
        .pagination { display: flex; justify-content: center; align-items: center; gap: 5px; margin-top: 20px; }
        .pagination a, .pagination span { padding: 7px 12px; border: 1px solid #dee2e6; border-radius: 4px; color: #007bff; text-decoration: none; }
        .pagination .active { background-color: #007bff; color: #white; border-color: #007bff; color: #fff; }
        .pagination .disabled { color: #6c757d; pointer-events: none; background-color: #fff; }
	</style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

	<!-- ================= NAVBAR ================= -->
	<th:block th:replace="~{admin-templ/fragments/navbar :: navbar}"></th:block>

	<th:block th:replace="~{admin-templ/fragments/sidebar-content :: sidebar-content}"></th:block>


	<div class="content-wrapper">
		<div class="content-header">
			<div class="container-fluid">
				<div class="row mb-2">
					<div class="col-sm-6">
						<h1 class="m-0">Danh sách truyện</h1>
					</div>
				</div>
			</div>
		</div>

		<section class="content">
			<div class="container-fluid">
				<div class="mb-3">
					<a class="btn btn-success" th:href="@{/asura/admin/comic/content/create}">
						<i class="fas fa-upload"></i> Upload Truyện Mới
					</a>
					<button type="button" class="btn btn-outline-secondary ml-2" onclick="location.reload();">
						<i class="fas fa-sync"></i> Làm mới
					</button>
				</div>

				<div class="card">
					<div class="card-body p-0">
						<table id="comicsTable">
							<thead>
							<tr>
								<th style="width: 50px">ID</th>
								<th>Tiêu đề truyện</th>
								<th>Thể loại</th>
								<th>Lượt xem</th>
								<th style="width: 150px">Thao tác</th>
							</tr>
							</thead>
							<tbody>
							<tr th:each="comic : ${comics}" th:id="'comic-row-' + ${comic.id}">
								<td th:text="${comic.id}"></td>
								<td>
									<a th:href="@{'/asura/admin/comic/content/' + ${comic.slug}}"
									   th:text="${comic.title}" class="font-weight-bold"></a>
								</td>
								<td><span class="badge badge-info" th:text="${comic.type}"></span></td>
								<td th:text="${#numbers.formatInteger(comic.viewCount, 0, 'COMMA')}"></td>
								<td class="action-buttons">
									<a th:href="@{'/asura/admin/comic/content/edit/' + ${comic.slug}}" title="Chỉnh sửa">
										<i class="fas fa-edit text-primary"></i>
									</a>
									<a class="delete" th:onclick="'deleteComic(' + ${comic.id} + ')'" title="Xóa">
										<i class="fas fa-trash-alt text-danger"></i>
									</a>
								</td>
							</tr>
							</tbody>
						</table>
					</div>

					<div class="card-footer clearfix">
						<div class="pagination" id="comicsPagination">
							<a th:if="${currentPage > 0}" th:href="@{/asura/admin/comic/content/detail(page=${currentPage - 1})}">«</a>
							<span th:unless="${currentPage > 0}" class="disabled">«</span>

							<a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
							   th:classappend="${i == currentPage} ? 'active'"
							   th:href="@{/asura/admin/comic/content/detail(page=${i})}"
							   th:text="${i + 1}"></a>

							<a th:if="${currentPage < totalPages - 1}" th:href="@{/asura/admin/comic/content/detail(page=${currentPage + 1})}">»</a>
							<span th:unless="${currentPage < totalPages - 1}" class="disabled">»</span>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>

<script src="/css/admin-assets/plugins/jquery/jquery.min.js"></script>
<script src="/css/admin-assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/css/admin-assets/dist/js/adminlte.js"></script>

<script>
	function deleteComic(comicId) {
        if (confirm("Bạn có chắc chắn muốn xóa truyện này? Hành động này không thể hoàn tác.")) {
            $.ajax({
                url: "/api/comics/" + comicId,
                type: "DELETE",
                success: function () {
                    $("#comic-row-" + comicId).fadeOut(400, function() { $(this).remove(); });
                },
                error: function (xhr) {
                    alert("Lỗi: " + xhr.responseText);
                }
            });
        }
    }
</script>
</body>
</html>